import{useSyncExternalStore as r}from"react";const t=t=>{let e={};const o=new Map,a=(r,t)=>{if(r&&o.has(r))throw new Error("cannot have two states with same key");return o.set(r,t),()=>{o.delete(r)}},n=(r,t=null)=>{e={...e,...r(e)},t?Array.isArray(t)?t.forEach((r=>o.has(r)&&o.get(r)())):o.has(t)&&o.get(t)():o.forEach(((r,t,e)=>r()))};e=t(n);const s=()=>e;return(t,e,f=null)=>{if("function"==typeof t){if(!e&&"function"!=typeof t(s()))for(;e=crypto.randomUUID(),o.has(e););return r((r=>a(e,r)),(()=>t(s())),(()=>f||t(s())))}return Array.isArray(t)?t.map((t=>r((r=>a(e,r)),(()=>s()[t]),(()=>f||s()[t])))):[s(),n]}};export{t as create};
